<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BFHL API Playground</title>
    <style>
      :root {
        --bg: #0b1020;
        --panel: #0f172a;
        --panel-2: #111827;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #22d3ee;
        --danger: #fca5a5;
        --ok: #86efac;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: radial-gradient(1000px 600px at 10% 10%, #0b2b3f, var(--bg));
        color: var(--text);
        min-height: 100vh;
        padding: 24px;
      }
      .container {
        max-width: 920px;
        margin: 0 auto;
      }
      header {
        margin-bottom: 16px;
      }
      h1 {
        margin: 0 0 8px;
        font-size: 28px;
      }
      p {
        margin: 0 0 12px;
        color: var(--muted);
      }
      .card {
        background: linear-gradient(180deg, #0b1220, var(--panel));
        border: 1px solid #1f2937;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
      }
      select,
      input,
      textarea,
      button {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #1f2937;
        background: var(--panel-2);
        color: var(--text);
        font-size: 14px;
      }
      textarea {
        min-height: 90px;
        resize: vertical;
        font-family: "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
      }
      .row {
        display: grid;
        gap: 12px;
      }
      @media (min-width: 720px) {
        .row {
          grid-template-columns: 1fr 1fr;
        }
      }
      .help {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }
      .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 8px;
      }
      button {
        cursor: pointer;
        background: linear-gradient(90deg, #0ea5e9, #22d3ee);
        border: none;
        color: #0b1020;
        font-weight: 700;
      }
      button.secondary {
        background: transparent;
        border: 1px solid #1f2937;
        color: var(--text);
      }
      pre {
        background: #0b0f1a;
        border: 1px solid #1f2937;
        border-radius: 12px;
        padding: 12px;
        overflow-x: auto;
      }
      .status {
        margin-top: 8px;
        font-size: 13px;
      }
      .status.ok {
        color: var(--ok);
      }
      .status.err {
        color: var(--danger);
      }
      .pill {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid #164e63;
        color: var(--accent);
        font-size: 12px;
      }
      footer {
        margin-top: 16px;
        color: var(--muted);
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="pill">BFHL API Playground</div>
        <h1>Test your API quickly</h1>
        <p>Choose a function, provide input, and send a request to <code>/bfhl</code>.</p>
      </header>

      <div class="card">
        <div class="row">
          <div>
            <label for="keySelect">Operation</label>
            <select id="keySelect">
              <option value="fibonacci">fibonacci</option>
              <option value="prime">prime</option>
              <option value="lcm">lcm</option>
              <option value="hcf">hcf</option>
              <option value="AI">AI</option>
            </select>
            <div class="help">Exactly one key is allowed in the request body.</div>
          </div>
          <div>
            <label for="inputMode">Input mode</label>
            <select id="inputMode">
              <option value="auto">auto (best guess)</option>
              <option value="number">single number</option>
              <option value="csv">comma-separated list</option>
              <option value="json">raw JSON</option>
              <option value="text">text (AI only)</option>
            </select>
            <div class="help">Use JSON if you want to send exact structures.</div>
          </div>
        </div>

        <div style="margin-top: 12px;">
          <label for="inputValue">Input</label>
          <textarea id="inputValue" placeholder="Examples: 7  |  1,2,3,4  |  [12,18,24]  |  What is the capital city of Maharashtra?"></textarea>
          <div class="help">
            Fibonacci expects a number. Prime/LCM/HCF expect a list of integers. AI expects a string.
          </div>
        </div>

        <div class="actions">
          <button id="sendBtn">Send Request</button>
          <button id="exampleBtn" class="secondary">Load Example</button>
          <button id="clearBtn" class="secondary">Clear</button>
        </div>

        <div class="status" id="status"></div>

        <h3>Request Body</h3>
        <pre id="requestPreview">{}</pre>

        <h3>Response</h3>
        <pre id="responsePreview">{}</pre>
      </div>

      <footer>Official email: akshay0017.be23@chitkara.edu.in</footer>
    </div>

    <script>
      const keySelect = document.getElementById("keySelect");
      const inputMode = document.getElementById("inputMode");
      const inputValue = document.getElementById("inputValue");
      const sendBtn = document.getElementById("sendBtn");
      const exampleBtn = document.getElementById("exampleBtn");
      const clearBtn = document.getElementById("clearBtn");
      const requestPreview = document.getElementById("requestPreview");
      const responsePreview = document.getElementById("responsePreview");
      const statusEl = document.getElementById("status");

      function setStatus(msg, type) {
        statusEl.textContent = msg || "";
        statusEl.className = "status" + (type ? ` ${type}` : "");
      }

      function tryParseJson(text) {
        try {
          return JSON.parse(text);
        } catch {
          return null;
        }
      }

      function parseCsv(text) {
        return text
          .split(",")
          .map((v) => v.trim())
          .filter((v) => v.length > 0)
          .map((v) => Number(v));
      }

      function buildPayload() {
        const key = keySelect.value;
        const mode = inputMode.value;
        const raw = inputValue.value.trim();

        if (!raw) {
          throw new Error("Input is required");
        }

        let value;

        if (mode === "json") {
          const parsed = tryParseJson(raw);
          if (parsed === null) throw new Error("Invalid JSON");
          value = parsed;
        } else if (mode === "csv") {
          value = parseCsv(raw);
        } else if (mode === "number") {
          value = Number(raw);
        } else if (mode === "text") {
          value = raw;
        } else {
          // auto
          const parsed = tryParseJson(raw);
          if (parsed !== null) {
            value = parsed;
          } else if (key === "AI") {
            value = raw;
          } else if (raw.includes(",")) {
            value = parseCsv(raw);
          } else {
            value = Number(raw);
          }
        }

        return { [key]: value };
      }

      function updatePreview() {
        try {
          const payload = buildPayload();
          requestPreview.textContent = JSON.stringify(payload, null, 2);
          setStatus("", "");
        } catch (err) {
          requestPreview.textContent = "{}";
          setStatus(err.message, "err");
        }
      }

      inputValue.addEventListener("input", updatePreview);
      keySelect.addEventListener("change", updatePreview);
      inputMode.addEventListener("change", updatePreview);

      exampleBtn.addEventListener("click", () => {
        const key = keySelect.value;
        if (key === "fibonacci") inputValue.value = "7";
        if (key === "prime") inputValue.value = "2,4,7,9,11";
        if (key === "lcm") inputValue.value = "[12,18,24]";
        if (key === "hcf") inputValue.value = "24,36,60";
        if (key === "AI") inputValue.value = "What is the capital city of Maharashtra?";
        updatePreview();
      });

      clearBtn.addEventListener("click", () => {
        inputValue.value = "";
        requestPreview.textContent = "{}";
        responsePreview.textContent = "{}";
        setStatus("", "");
      });

      sendBtn.addEventListener("click", async () => {
        try {
          const payload = buildPayload();
          requestPreview.textContent = JSON.stringify(payload, null, 2);
          setStatus("Sending request...", "");

          const res = await fetch("/bfhl", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const text = await res.text();
          let parsed;
          try {
            parsed = JSON.parse(text);
          } catch {
            parsed = { raw: text };
          }

          responsePreview.textContent = JSON.stringify(parsed, null, 2);
          if (res.ok) {
            setStatus("Success", "ok");
          } else {
            setStatus(`Error ${res.status}`, "err");
          }
        } catch (err) {
          setStatus(err.message, "err");
        }
      });

      updatePreview();
    </script>
  </body>
</html>
